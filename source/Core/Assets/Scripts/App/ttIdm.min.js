(function(n){function r(n,t){t&&n.interceptors.push(function(n){return{request:function(n){return t.token&&(n.headers.Authorization="Bearer "+t.token.access_token),n},responseError:function(t){return t.status===401&&i.removeToken(),n.reject(t)}}})}function i(n,t,i){function s(){e.forEach(function(n){n()})}function h(){o.forEach(function(n){n()})}var r=i.localStorage,u,f,e,o;return n&&(u=r.getItem("idm.token"),u&&(f=Token.fromJSON(u),f.expired||(n.token=f))),e=[],o=[],{addOnTokenExpired:function(n){e.push(n)},addOnTokenObtained:function(n){o.push(n)},hasToken:function(){return n&&n.token&&!n.token.expired},isTokenNeeded:function(){return n&&(!n.token||n.token.expired)},removeToken:function(){r.removeItem("idm.token");n.token=null;s()},redirectForToken:function(r){var o=new OAuthClient(i.localStorage),u=t.absUrl(),f=u.indexOf("#"),e;f>0&&(u=u.substring(0,f));u+="#/"+r;e=o.createImplicitRequest(n.AuthorizationUrl,n.ClientId,u,n.Scope);i.location=e.url},processTokenCallback:function(u,f){var o=new OAuthClient(i.localStorage),e=o.readImplicitResult(t.url());e.error?f&&f(e.error):(n.token=Token.fromOAuthResponse(e),r.setItem("idm.token",n.token.toJSON()),h(),u&&u())}}}function u(n,t,i,r){var u=null;return n.addOnTokenExpired(function(){u=null}),{get:function(){if(u){var n=i.defer();return n.resolve(u),n.promise}return t.get(r+"/api").then(function(n){return u=n.data},function(n){if(u=null,n.status===401)throw"You are not authorized to use this service.";else throw"Failed to load API.";})}}}function f(n,t,i){function f(){}function e(n){return n.data}function u(n){return n=n||"Unexpected Error",function(t){t.data.exceptionMessage&&i.error(t.data.exceptionMessage);throw t.data.errors||t.data.message||n;}}var r=t.get().then(function(t){r.getUsers=function(i,r,f){return n.get(t.links.users,{params:{filter:i,start:r,count:f}}).then(e,u("Error Getting Users"))};r.getUser=function(i){return n.get(t.links.users+"/"+encodeURIComponent(i)).then(e,u("Error Getting User"))};t.links.createUser&&(r.createUser=function(i){return n.post(t.links.createUser.href,i).then(e,u("Error Creating User"))});r.deleteUser=function(t){return n.delete(t.links.delete).then(f,u("Error Deleting User"))};r.setProperty=function(t){return t.data===0&&(t.data="0"),t.data===!1&&(t.data="false"),n.put(t.links.update,t.data).then(f,u(t.meta&&t.meta.name&&"Error Setting "+t.meta.name||"Error Setting Property"))};r.addClaim=function(t,i){return n.post(t.links.create,i).then(f,u("Error Adding Claim"))};r.removeClaim=function(t){return n.delete(t.links.delete).then(f,u("Error Removing Claim"))};r.addRole=function(t){return n.post(t.links.add).then(f,u("Error Adding Role"))};r.removeRole=function(t){return n.delete(t.links.remove).then(f,u("Error Removing Role"))}});return r}function e(n,t,i){function e(){}function f(n){return n.data}function u(n){return n=n||"Unexpected Error",function(t){t.data.exceptionMessage&&i.error(t.data.exceptionMessage);throw t.data.errors||t.data.message||n;}}var r=t.get().then(function(t){r.getRoles=function(i,r,e){return n.get(t.links.roles,{params:{filter:i,start:r,count:e}}).then(f,u("Error Getting Roles"))};r.getRole=function(i){return n.get(t.links.roles+"/"+encodeURIComponent(i)).then(f,u("Error Getting Role"))};r.setProperty=function(t){return t.data===0&&(t.data="0"),t.data===!1&&(t.data="false"),n.put(t.links.update,t.data).then(e,u(t.meta&&t.meta.name&&"Error Setting "+t.meta.name||"Error Setting Property"))};t.links.createRole&&(r.createRole=function(i){return n.post(t.links.createRole.href,i).then(f,u("Error Creating Role"))});r.deleteRole=function(t){return n.delete(t.links.delete).then(e,u("Error Deleting Role"))}});return r}var t=n.module("ttIdm",[]);r.$inject=["$httpProvider","OAuthConfig"];t.config(r);i.$inject=["OAuthConfig","$location","$window","$rootScope"];t.factory("idmToken",i);u.$inject=["idmToken","$http","$q","PathBase"];t.factory("idmApi",u);f.$inject=["$http","idmApi","$log"];t.factory("idmUsers",f);e.$inject=["$http","idmApi","$log"];t.factory("idmRoles",e)})(angular),function(n){var t=document.getElementById("model").textContent.trim(),i;t=JSON.parse(t);for(i in t)n.module("ttIdm").constant(i,t[i])}(angular);
/*
//# sourceMappingURL=ttIdm.min.js.map
*/