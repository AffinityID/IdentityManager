(function(n){function i(n,t){t&&n.interceptors.push(function(){return{request:function(n){return t.token&&!t.token.expired&&(n.headers.Authorization="Bearer "+t.token.access_token),n}}})}function r(n,t,i,r){var h=i.localStorage,e,f,o,s,l;if(t.path()==="/callback")e=new OAuthClient(i.localStorage),f=e.readImplicitResult(t.url()),f.error?(r.errors=[f.error],t.url("/error")):(n.token=Token.fromOAuthResponse(f),h.setItem("idm.token",n.token.toJSON()),t.url("/"));else if(n&&(o=h.getItem("idm.token"),o&&(s=Token.fromJSON(o),s.expired||(n.token=s)),!n.token)){var e=new OAuthClient(i.localStorage),u=t.absUrl(),c=u.indexOf("#");c>0&&(u=u.substring(0,c));u+="#/callback";l=e.createImplicitRequest(n.AuthorizationUrl,n.ClientId,u,n.Scope);i.location=l.url}}function u(t,i,r,u){var f=i.defer(),e=f.promise;return(u&&u.token||!u)&&t.get(r+"/api").then(function(t){n.extend(e,t.data);f.resolve()},function(n){n.status===401?f.reject("You are not authorized to use this service."):f.reject("Failed to load API.")}),e}function f(n,t,i){function f(){}function e(n){return n.data}function u(n){return n=n||"Unexpected Error",function(t){t.data.exceptionMessage&&i.error(t.data.exceptionMessage);throw t.data.errors||t.data.message||n;}}var r=t.then(function(){r.getUsers=function(i,r,f){return n.get(t.links.users,{params:{filter:i,start:r,count:f}}).then(e,u("Error Getting Users"))};r.getUser=function(i){return n.get(t.links.users+"/"+encodeURIComponent(i)).then(e,u("Error Getting User"))};t.links.createUser&&(r.createUser=function(i){return n.post(t.links.createUser.href,i).then(e,u("Error Creating User"))});r.deleteUser=function(t){return n.delete(t.links.delete).then(f,u("Error Deleting User"))};r.setProperty=function(t){return t.data===0&&(t.data="0"),t.data===!1&&(t.data="false"),n.put(t.links.update,t.data).then(f,u(t.meta&&t.meta.name&&"Error Setting "+t.meta.name||"Error Setting Property"))};r.addClaim=function(t,i){return n.post(t.links.create,i).then(f,u("Error Adding Claim"))};r.removeClaim=function(t){return n.delete(t.links.delete).then(f,u("Error Removing Claim"))};r.addRole=function(t){return n.post(t.links.add).then(f,u("Error Adding Role"))};r.removeRole=function(t){return n.delete(t.links.remove).then(f,u("Error Removing Role"))}});return r}function e(n,t,i){function e(){}function f(n){return n.data}function u(n){return n=n||"Unexpected Error",function(t){t.data.exceptionMessage&&i.error(t.data.exceptionMessage);throw t.data.errors||t.data.message||n;}}var r=t.then(function(){r.getRoles=function(i,r,e){return n.get(t.links.roles,{params:{filter:i,start:r,count:e}}).then(f,u("Error Getting Roles"))};r.getRole=function(i){return n.get(t.links.roles+"/"+encodeURIComponent(i)).then(f,u("Error Getting Role"))};r.setProperty=function(t){return t.data===0&&(t.data="0"),t.data===!1&&(t.data="false"),n.put(t.links.update,t.data).then(e,u(t.meta&&t.meta.name&&"Error Setting "+t.meta.name||"Error Setting Property"))};t.links.createRole&&(r.createRole=function(i){return n.post(t.links.createRole.href,i).then(f,u("Error Creating Role"))});r.deleteRole=function(t){return n.delete(t.links.delete).then(e,u("Error Deleting Role"))}});return r}var t=n.module("ttIdm",[]);i.$inject=["$httpProvider","OAuthConfig"];t.config(i);r.$inject=["OAuthConfig","$location","$window","$rootScope"];t.run(r);u.$inject=["$http","$q","PathBase","OAuthConfig"];t.factory("idmApi",u);f.$inject=["$http","idmApi","$log"];t.factory("idmUsers",f);e.$inject=["$http","idmApi","$log"];t.factory("idmRoles",e)})(angular),function(n){var t=document.getElementById("model").textContent.trim(),i;t=JSON.parse(t);for(i in t)n.module("ttIdm").constant(i,t[i])}(angular);
/*
//# sourceMappingURL=ttIdm.min.js.map
*/