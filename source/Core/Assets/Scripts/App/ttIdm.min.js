(function(n){function i(n,t){if(t){function i(n,i){return{request:function(n){return t.token&&(n.headers.Authorization="Bearer "+t.token.access_token),n},responseError:function(r){return r.status===401&&t.token&&i.removeToken(),n.reject(r)}}}i.$inject=["$q","idmToken"];n.interceptors.push(i)}}function r(n,t,i,r,u,f,e,o){function l(n){r&&r.PersistToken&&n?s.setItem("idm.token",n.toJSON()):s.removeItem("idm.token")}function w(){var n,t;if(r&&r.PersistToken&&(n=s.getItem("idm.token"),n&&(t=i.fromJSON(n),!t.expired)))return t}function b(){o.$evalAsync(function(){a.forEach(function(n){n()})})}function p(){o.$evalAsync(function(){v.forEach(function(n){n()})})}var s=e.localStorage,h=new t(s),c=null,y,a,v;return r&&(r.token=w(),r.AutomaticallyRenewToken&&(y=e.location.protocol+"//"+e.location.host+n+"/frame",c=new u(r.AuthorizationUrl,r.ClientId,y,r.Scope,function(n){var t=h.readImplicitResult(n);t.error||(r.token=i.fromOAuthResponse(t),l(r.token),p())}))),a=[],v=[],{addOnTokenRemoved:function(n){a.push(n)},addOnTokenObtained:function(n){v.push(n)},getToken:function(){return r&&r.token},hasToken:function(){return!!(r&&r.token&&!r.token.expired)},isTokenNeeded:function(){return!!(r&&(!r.token||r.token.expired))},removeToken:function(){l(null);r.token=null;b()},redirectForToken:function(n){var t=f.absUrl(),i=t.indexOf("#"),u;i>0&&(t=t.substring(0,i));t+="#/"+n;u=h.createImplicitRequest(r.AuthorizationUrl,r.ClientId,t,r.Scope);e.location=u.url},processTokenCallback:function(n,t){var u=h.readImplicitResult(f.url());u.error?t&&t(u.error):(r.token=i.fromOAuthResponse(u),l(r.token),p(),n&&n())},tryRenewToken:function(){c&&c.tryRenewToken()}}}function u(n,t,i,r){var u=null;return n.addOnTokenRemoved(function(){u=null}),{get:function(){if(u){var n=i.defer();return n.resolve(u),n.promise}return t.get(r+"/api").then(function(n){return u=n.data},function(n){if(u=null,n.status===401)throw"You are not authorized to use this service.";else throw"Failed to load API.";})}}}function f(n,t,i){function f(){}function e(n){return n.data}function u(n){return n=n||"Unexpected Error",function(t){t.data.exceptionMessage&&i.error(t.data.exceptionMessage);throw t.data.errors||t.data.message||n;}}var r=t.get().then(function(t){r.getUsers=function(i,r,f){return n.get(t.links.users,{params:{filter:i,start:r,count:f}}).then(e,u("Error Getting Users"))};r.getUser=function(i){return n.get(t.links.users+"/"+encodeURIComponent(i)).then(e,u("Error Getting User"))};t.links.createUser&&(r.createUser=function(i){return n.post(t.links.createUser.href,i).then(e,u("Error Creating User"))});r.deleteUser=function(t){return n.delete(t.links.delete).then(f,u("Error Deleting User"))};r.setProperty=function(t){return t.data===0&&(t.data="0"),t.data===!1&&(t.data="false"),n.put(t.links.update,t.data).then(f,u(t.meta&&t.meta.name&&"Error Setting "+t.meta.name||"Error Setting Property"))};r.addClaim=function(t,i){return n.post(t.links.create,i).then(f,u("Error Adding Claim"))};r.removeClaim=function(t){return n.delete(t.links.delete).then(f,u("Error Removing Claim"))};r.addRole=function(t){return n.post(t.links.add).then(f,u("Error Adding Role"))};r.removeRole=function(t){return n.delete(t.links.remove).then(f,u("Error Removing Role"))}});return r}function e(n,t,i){function e(){}function f(n){return n.data}function u(n){return n=n||"Unexpected Error",function(t){t.data.exceptionMessage&&i.error(t.data.exceptionMessage);throw t.data.errors||t.data.message||n;}}var r=t.get().then(function(t){r.getRoles=function(i,r,e){return n.get(t.links.roles,{params:{filter:i,start:r,count:e}}).then(f,u("Error Getting Roles"))};r.getRole=function(i){return n.get(t.links.roles+"/"+encodeURIComponent(i)).then(f,u("Error Getting Role"))};r.setProperty=function(t){return t.data===0&&(t.data="0"),t.data===!1&&(t.data="false"),n.put(t.links.update,t.data).then(e,u(t.meta&&t.meta.name&&"Error Setting "+t.meta.name||"Error Setting Property"))};t.links.createRole&&(r.createRole=function(i){return n.post(t.links.createRole.href,i).then(f,u("Error Creating Role"))});r.deleteRole=function(t){return n.delete(t.links.delete).then(e,u("Error Deleting Role"))}});return r}var t=n.module("ttIdm",[]);i.$inject=["$httpProvider","OAuthConfig"];t.config(i);r.$inject=["PathBase","OAuthClient","Token","OAuthConfig","OAuthFrame","$location","$window","$rootScope"];t.factory("idmToken",r);u.$inject=["idmToken","$http","$q","PathBase"];t.factory("idmApi",u);f.$inject=["$http","idmApi","$log"];t.factory("idmUsers",f);e.$inject=["$http","idmApi","$log"];t.factory("idmRoles",e)})(angular),function(n){var t=document.getElementById("model").textContent.trim(),i;t=JSON.parse(t);for(i in t)n.module("ttIdm").constant(i,t[i]);n.module("ttIdm").constant("OAuthClient",OAuthClient);n.module("ttIdm").constant("Token",Token);n.module("ttIdm").constant("OAuthFrame",OAuthFrame)}(angular);
/*
//# sourceMappingURL=ttIdm.min.js.map
*/